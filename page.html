<html>
<head><title>Wiki Search</title>
	<style type="text/css">
		a {text-decoration:none;}
		#resultsUl {margin-left:180px;}
		.resultLi {list-style-type:none;padding-bottom:10px;}
		#leftLink {float:left;}
		#rightLink {float:right;}
		#footer {margin-top:10px;border:1px solid;height:20px;padding:10px 20px;display:none;}
	</style>
</head>
<body>
	<div id="container" style="margin-left:200px;">
		<h1 style="margin-left:320px;">Wiki Search</h1>
		<div style="margin-left:100px;border-top:1px solid;padding-top:20px;width:700px;">
			<div>
				<input type="text" id="textBox" style="width:300px;margin-left:100px;"></input>
				<button id="connectToServer"  style="margin-left:50px;" value="Search" >Search</button>
			</div>
			<div id="loadingIcon" style="margin-top:50px;margin-left:135px;"></div>
			<div id="results" >
			</div>
			<div id="footer">
				<a href="#" id="leftLink">Previous</a>
				<a href="#" id="rightLink">Next</a>
			</div>
		</div>
		<div id="pageNum" style="display:none;">0</div>
	</div>
	<script type="text/javascript">

var textBox = document.getElementById("textBox");

function setUpPersistantConnection(e){
	xmlhttp=new XMLHttpRequest();
	xmlhttp.onreadystatechange=function(){
		try{
			if( xmlhttp.status==200){
				var textSent = new String(xmlhttp.responseText);
				document.getElementById("loadingIcon").innerHTML="<span></span>";
				document.getElementById("results").innerHTML= textSent;
				document.getElementById("results").style.visibility="visible";
				document.getElementById("footer").style.display= "block";
			}
		}catch(e){
			console.log(e.message + " Xml status : ");
		}
	};
	var query=textBox.value;
	var pageNum = document.getElementById("pageNum").innerHTML;
	xmlhttp.open("POST","http://192.168.0.9:5000?q=" +query+ "&pageNum="+pageNum+"&param=EOS",true);
	xmlhttp.send("STUFF POSTED");
	document.getElementById("results").style.visibility="hidden";
	document.getElementById("loadingIcon").innerHTML="<img src='http://l.yimg.com/t/yil/yil20120208/images/ajax-loader-bar.gif' />";
};


function setEventHandlers(){
	var connectButton=document.getElementById("connectToServer");
	connectButton.onclick=function(e){
		document.getElementById("pageNum").innerHTML = 0;
		setUpPersistantConnection(e);
	}

	var pageNum = document.getElementById("pageNum").innerHTML;

	var previousLink = document.getElementById("leftLink");
	previousLink.onclick=function(e){
		if(pageNum == 0)
		{
			alert("First page");
			return;
		}
		pageNum = parseInt(pageNum)-1;
		document.getElementById("pageNum").innerHTML = pageNum;
		setUpPersistantConnection(e);
	}
	var nextLink = document.getElementById("rightLink");
	nextLink.onclick=function(e){
		pageNum = parseInt(pageNum)+1;
		document.getElementById("pageNum").innerHTML = pageNum;
		setUpPersistantConnection(e);
	}
};

function main(){
	setEventHandlers();	
}
main();
</script>

</body>
</html>
